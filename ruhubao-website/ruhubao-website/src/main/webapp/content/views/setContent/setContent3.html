<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>内容管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" type="images/x-icon" href="../layuiadmin/style/res/bolinglink.png">
    <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/admin.css" media="all">
    
    <link href="/js/kindeditor-4.1.10/themes/default/default.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8" src="../../../js/kindeditor-4.1.10/kindeditor-all-min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../../js/kindeditor-4.1.10/lang/zh_CN.js"></script>
    
    <script>
      /^http(s*):\/\//.test(location.href) || alert('请先部署到 localhost 下再访问');
  </script>
    <style type="text/css">
      html,
      body {
        padding: 20px;
        position: relative;
      }

      .layui-side {
        margin-left: 15px;
      }

      .layui-side,
      .layui-side-menu {
        height: 650px !important;
      }
      .layui-layout-admin .layui-side{
        z-index: 50 !important;
      }
        
      #LAY_app_body {
        position: absolute;
        top: -50px;
        left: 190px;
        padding: 20px 0 50px;
        z-index: 60 !important;
        height: 1800px;
        min-height: 800px;
      }
      .layui-table-tool-temp{
        padding-left: 60px;
        padding-top: 40px;
      }
      
      .showBox{
        height: 400px;
      }
        
      
      /* add 弹框 */
      .add{
        position: fixed !important;
        position: relative;
        width: 900px;
        height: 750px;
        left: 300px;
        top: 20px;
        background-color: #fff;
        z-index: 1400 !important;
        padding: 20px;
        padding:10px 10px 10px 10px;
        display: none;
        border: 1px solid goldenrod;
      }
      .add .close{
        display: inline-block;
        position: absolute;
        right: 30px;
        top: 50px;
        width: 30px;
        height: 30px;
        line-height: 24px;
        color: #fff;
        font-size: 20px;
        font-weight: 800;
        cursor: pointer;
        background-color: #CCCCCC;
        text-align: center;
        border-radius: 30px;
      }
      
      #contentAddForm{
        padding: 50px 10px 10px 20px;
      }
      #contentAddForm input,.add input{
        padding-left: 7px;
        display: inline-block;
        width: 400px !important;
        height: 28px !important;
      }
      input.area{
        height: 40px !important;
        width: 400px !important;
        display: inline-block;
        padding: 10px;
        line-height: 24px !important;
      }
      
      td{
        height: 50px;
      }
      .easyui-linkbutton{
        width: 80px;
        height: 32px;
        background-color: green;
        color: #fff;
        display: inline-block;
        text-align: center;
        line-height: 32px;
      }
      .easyui-linkbutton:hover{
        color: #fff;
      }
    </style>
  </head>
  <body class="layui-layout-body" style="margin: 20px;">

    <div id="LAY_app">
      <div class="layui-layout layui-layout-admin">
        <!-- 侧边菜单 -->
        <div class="layui-side layui-side-menu">
          <div class="layui-side-scroll">
            <div class="layui-logo" style="margin-left: 15px;" lay-href="home/console.html">
              <span>类型管理</span>
            </div>
            <!-- 内容管理 -->
            <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu" lay-filter="layadmin-system-side-menu">
              <li data-name="home" class="layui-nav-item layui-nav-itemed">
                <a href="javascript:;" lay-tips="主页" lay-direction="2">
                  <i class="layui-icon layui-icon-home"></i>
                  <cite>内容管理</cite>
                </a>
                <dl class="layui-nav-child">
                  <!-- class="layui-this" -->
                  <dd data-name="console" class="layui-this">
                    <a data-id="">最新政策</a>
                  </dd>
                  <dd data-name="console">
                    <a data-id="">办事指南</a>
                  </dd>
                  <dd data-name="console">
                    <a data-id="">服务窗口</a>
                  </dd>
                  <dd data-name="console">
                    <a data-id="">常见问题</a>
                  </dd>
                  <dd data-name="console">
                    <a>新闻资讯</a>
                  </dd>
                </dl>
              </li>
            </ul>
          </div>
        </div>


        <!-- 主体内容 -->
        <div class="layui-body" id="LAY_app_body">
          <div class="layadmin-tabsbody-item layui-show" style="position: relative;">
            <!-- 显示的内容 -->
            <div class="conten-box">
              <!-- 显示的数据 -->
              <div class="showBox" style="padding: 0 9px;">
                <table class="layui-hide" style="padding-left: 10px;overflow: scroll;" id="demo" lay-filter="test"></table>

                <script type="text/html" id="barDemo">
                  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                </script>
              </div>
               
              
               <!-- 添加 -->
              <div class="add add-content">
                <!-- 关闭按钮 -->
                <span class="close">x</span>
                <form id="contentAddForm" class="itemForm" method="post">
                  <input type="hidden" name="categoryId" />
                  <table cellpadding="5" style="width: 100%;">
                    <tr>
                      <td width="120">内容标题:</td>
                      <td><input class="easyui-textbox" type="text" name="title" data-options="required:true" style="width: 280px;"></input></td>
                    </tr>
                    <tr>
                      <td width="120">内容子标题:</td>
                      <td><input class="easyui-textbox" type="text" name="subTitle" style="width: 280px;"></input></td>
                    </tr>
                    <tr>
                      <td>内容描述:</td>
                      <td style="height: 90px;">
                        <input type="txet" name="" class="area" id="" value="" />
                      </td>
                    </tr>
                    <tr>
                      <td>图片:</td>
                      <td>
                        <a href="javascript:void(0)" class="easyui-linkbutton onePicUpload">图片上传</a>
                        <br><input type="hidden" name="pic" />
                      </td>
                    </tr>
                    <tr>
                      <td>文章对应文件附件:</td>
                      <td>
                        <a href="javascript:void(0)" class="easyui-linkbutton onePicUpload">附件上传</a>
                        <br><input type="hidden" name="pic2" />
                      </td>
                    </tr>
                    <tr>
                      <td>内容:</td>
                      <td>
                        <textarea style="width:800px;height:300px;visibility:hidden;" name="content"></textarea>
                      </td>
                    </tr>
                  </table>
                </form>
                <div style="padding:5px">
                  <a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">提交</a>
                  <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">重置</a>
                </div>
              </div>
              
              <!-- 编辑 -->
               <div class="add edit">
                <!-- 关闭按钮 -->
                <span class="close">x</span>
                <form id="contentEditForm" class="itemForm" method="post">
                  <input type="hidden" name="categoryId" />
                  <table cellpadding="5" style="width: 100%;">
                    <tr>
                      <td width="120">内容标题:</td>
                      <td><input class="easyui-textbox" type="text" name="title" data-options="required:true" style="width: 280px;"></input></td>
                    </tr>
                    <tr>
                      <td width="120">内容子标题:</td>
                      <td><input class="easyui-textbox" type="text" name="subTitle" style="width: 280px;"></input></td>
                    </tr>
                    <tr>
                      <td>内容描述:</td>
                      <td style="height: 90px;">
                        <input type="txet" name="" class="area" id="" value="" />
                      </td>
                    </tr>
                    <tr>
                      <td>图片:</td>
                      <td>
                        <a href="javascript:void(0)" class="easyui-linkbutton onePicUpload">图片上传</a>
                        <img src="" alt="">
                        <br><input type="hidden" name="pic" />
                      </td>
                    </tr>
                    <tr>
                      <td>文章对应文件附件:</td>
                      <td>
                        <a href="javascript:void(0)" class="easyui-linkbutton onePicUpload">附件上传</a>
                        <br><input type="hidden" name="pic2" />
                      </td>
                    </tr>
                    <tr>
                      <td>内容:</td>
                      <td>
                        <textarea style="width:800px;height:300px;visibility:hidden;" name="content"></textarea>
                      </td>
                    </tr>
                  </table>
                </form>
                <div style="padding:5px">
                  <a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">提交</a>
                  <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">重置</a>
                </div>
              </div>
              
              
            </div>
          </div>
        
        </div>

        <!-- 辅助元素，一般用于移动设备下遮罩 -->
        <div class="layadmin-body-shade" layadmin-event="shade"></div>
      </div>
    
     
    </div>


   



    <script src="../../../js/jquery2.01.js"></script>
    <script src="../../js/jquery.easyui.min.js"></script>
    <script src="../../js/easyui-lang-zh_CN.js"></script>
    <script src="../../../ku/layui/layui.all.js"></script>
    <!-- https://www.bolinjy.cn/content/?categoryId=2&page=1&rows=20  编辑的数据 -->
    <!-- https://www.bolinjy.cn/content/category?id=1 获取类型数据 -->
    <!-- https://www.bolinjy.cn/content/?categoryId=4&page=1&rows=20 获取单个类型数据列表-->
    <script>
      layui.config({
        base: '../../layuiadmin/' //静态资源所在路径
      }).extend({
        index: 'lib/index' //主入口模块
      }).use('index');
    </script>

    <!-- 百度统计 -->
    <script>
      // var _hmt = _hmt || [];
      // (function() {
      //   var hm = document.createElement("script");
      //   hm.src = "https://hm.baidu.com/hm.js?d214947968792b839fd669a4decaaffc";
      //   var s = document.getElementsByTagName("script")[0];
      //   s.parentNode.insertBefore(hm, s);
      // })();
      
      
      // https://bolinjy.cn/content/category  categoryId

      

      table = layui.table //表格

      //执行一个 table 实例

      table.render({
        elem: '#demo',
        height: 420,
        url: 'data1.json' //数据接口
          ,
        title: '文章列表',
        toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
          ,
        cols: [
          [ //表头
            {
              type: 'checkbox',
              fixed: 'left'
            }, {
              field: 'id',
              title: 'ID',
              width: 80,
              sort: true,
              fixed: 'left',
              totalRowText: '合计：'
            }, {
              field: 'title',
              title: '内容标题',
            }, {
              field: 'subTitle',
              title: '内容子标题',
              sort: true,
              width: 80,
              totalRow: true
            }, {
              field: 'titleDesc',
              title: '内容描述',
              width: 120,
              sort: true
            }, {
              field: 'url',
              title: '内容链接',
              sort: true,
              totalRow: true
            }, {
              field: 'pic',
              title: '图片',
            }, {
              field: 'pic2',
              title: '相关文件',
              width: 200
            }, {
              field: 'created',
              title: '创建日期',
            }, {
              field: 'updated',
              title: '更新日期',
              sort: true,
              totalRow: true
            }
          ]
        ]
      });


      //监听头工具栏事件
      table.on('toolbar(test)', function(obj) {
        var checkStatus = table.checkStatus(obj.config.id),
          data = checkStatus.data; //获取选中的数据
        switch (obj.event) {
          case 'add':
            $('.add-content').show();
            break;
          case 'update':
            if (data.length === 0) {
              layer.msg('请选择一行');
            } else if (data.length > 1) {
              layer.msg('只能同时编辑一个');
            } else {
              // layer.alert('编辑 [id]：' + checkStatus.data[0].id);
              
              //对表单赋值
              $('.edit').show();
            }
            break;
          case 'delete':
            if (data.length === 0) {
              layer.msg('请选择一行');
            } else {
             
             var data = checkStatus.data;
             var ids = "";
             for(var i=0;i<checkStatus.data.length;i++){
               ids += checkStatus.data[i].id+",";
             }
             
             console.log(data,ids)
             
             
              $.ajax({
                type:'get',
                url:'data.json',
                data:{
                  id:ids
                },
                success:function(res){
                   alert('删除成功')
                   //重新刷新表格
                   table.render()
                },
                error:function(){
                  alert('删除失败')
                }
              })
            }
            break;
        };
      });

  
    //编辑器参数
    kingEditorParams = {
    	filePostName  : "pictureFile",   
    	uploadJson : '/pic/uploadFile',	
    	dir : "image" 
    };
    
    var contentAddEditor ;
    var contentAddEditor2 ;
    
    $(function(){
    	//创建富文本编辑器
    	contentAddEditor =  KindEditor.create("#contentAddForm [name=content]", kingEditorParams);
      contentAddEditor2 =  KindEditor.create("#contentEditForm [name=content]", kingEditorParams);
      
    	//初始化单图片上传
    	initOnePicUpload();
    	//把内容分类id放到input中，提交到后台
    	// $("#contentAddForm [name=categoryId]").val($("#contentCategoryTree").tree("getSelected").id);
    });
    
    //关闭add 弹框
    $('.close').click(function(){
      $('.add').hide()
    })
    
    // add提交逻辑
    function submitForm(){
    	//校验
      
    	if(!$('#contentAddForm').form('validate')){
        alert('提示:  表单还未填写完成!')
    		return ;
    	}
    	contentAddEditor.sync();
    	
    	//提交到后台的RESTful  /content/savaContent POST
    	$.ajax({
    	   type: "get",
    	   url: "data.json",
    	   data: $("#contentAddForm").serialize(),
    	   success: function(msg){
    		   $.messager.alert('提示','新增内容成功!');
    					$("#contentList").datagrid("reload");
    					TT.closeCurrentWindow();
               table.render() //重新渲染表格
    	   },
    	   error: function(){
    		   $.messager.alert('提示','新增内容失败!');
    	   }
    	});
    }
    
    
    //编辑提交
    function submintEdit(){
      if(!$('#contentEditForm').form('validate')){
      	$.messager.alert('提示','表单还未填写完成!');
      	return ;
      }
      contentEditEditor.sync();
      
      $.post("/content/edit",$("#contentEditForm").serialize(), function(data){
      	//if(data.status == 200){
      		$.messager.alert('提示','编辑内容成功!');
      		$("#contentList").datagrid("reload");
      		TT.closeCurrentWindow();
      	//}
      });
    }
    
    function clearForm(){
    	$('#contentAddForm').form('reset');
    	contentAddEditor.html('');
    }
    
    function initOnePicUpload(){
      	$(".onePicUpload").click(function(){
    		var input = $(this).siblings("input");
    		KindEditor.editor(kingEditorParams).loadPlugin('image', function() {
    			this.plugin.imageDialog({
    				showRemote : false,
    				clickFn : function(url, title, width, height, border, align) {
    					input.parent().find("img").remove();
    					input.val(url);
    					input.after("<a href='"+url+"' target='_blank'><img src='"+url+"' width='80' height='50'/></a>");
    					this.hideDialog();
    				}
    			});
    		});
    	});
    }
    
    </script>
  </body>
</html>
